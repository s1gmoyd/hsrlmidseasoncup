<html>
    <head>
      <script src="js/WsSubscribers.js"></script>
      <script src="js/OverlaySystemWsSubscribers.js"></script>
      <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="css/in-game-active-player-new.css">
    </head>
    <body>
        <div id="player-summary" class="hidden">
          <div id="player-name-container">
            <div id="player-name" class="main-stat">kjfakjfdskjds</div>
          </div>

          <div id="main-stat-titles-container">
            <div id="player-goals-title" class="main-stat-title">Goals</div>
            <div id="player-assists-title" class="main-stat-title">Assists</div>
            <div id="player-shots-title" class="main-stat-title">Shots</div>
            <div id="player-saves-title" class="main-stat-title">Saves</div>
            <div id="player-touches-title" class="main-stat-title">Touches</div>
            <div id="player-score-title" class="main-stat-title">Score</div> 
          </div>

          <div id="main-stat-container">
            <div id="player-goals" class="main-stat">5</div>
            <div id="player-assists" class="main-stat">3</div>
            <div id="player-shots" class="main-stat">4</div>
            <div id="player-saves" class="main-stat">6</div>
            <div id="player-touches" class="main-stat">2</div>
            <div id="player-score" class="main-stat">2</div> 
          </div>

          <div id="player-boost-bar-container">
            <div id="player-speed" class="boost-stat">88 kph</div>
            <div id="player-boost" class="boost-stat">100</div>
            <div id="player-boost-bar"></div>
          </div>
        </div>

        <script>
            $(() => {
              let overlayData;
              //<!--- My RL Overlay Control System --->
              OverlayWsSubscribers.init(49321, false);
              OverlayWsSubscribers.subscribe("overlay", "full_update-2021hsmidseason", (data) => {
                overlayData = data;
                $(':root').css("--blueHomePrimaryColor", data["blueUniversity"]["color_home_primary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_home_primary"]}` : "#0051ff");
                $(':root').css("--blueHomeSecondaryColor", data["blueUniversity"]["color_home_secondary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_home_secondary"]}` : "#0051ff");
                $(':root').css("--blueAwayPrimaryColor", data["blueUniversity"]["color_away_primary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_away_primary"]}` : "#0051ff");
                $(':root').css("--blueAwaySecondaryColor", data["blueUniversity"]["color_away_secondary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_away_secondary"]}` : "#0051ff");
                $(':root').css("--blueAlternatePrimaryColor", data["blueUniversity"]["color_alternate_primary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_alternate_primary"]}` : "#0051ff");
                $(':root').css("--blueAlternateSecondaryColor", data["blueUniversity"]["color_alternate_secondary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_alternate_secondary"]}` : "#0051ff");
                $(':root').css("--orangeHomePrimaryColor", data["orangeUniversity"]["color_home_primary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_home_primary"]}` : "#ffaa00");
                $(':root').css("--orangeHomeSecondaryColor", data["orangeUniversity"]["color_home_secondary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_home_secondary"]}` : "#ffaa00");
                $(':root').css("--orangeAwayPrimaryColor", data["orangeUniversity"]["color_away_primary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_away_primary"]}` : "#ffaa00");
                $(':root').css("--orangeAwaySecondaryColor", data["orangeUniversity"]["color_away_secondary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_away_secondary"]}` : "#ffaa00");
                $(':root').css("--orangeAlternatePrimaryColor", data["orangeUniversity"]["color_alternate_primary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_alternate_primary"]}` : "#ffaa00");
                $(':root').css("--orangeAlternateSecondaryColor", data["orangeUniversity"]["color_alternate_secondary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_alternate_secondary"]}` : "#ffaa00")
                //Transparent versions
                $(':root').css("--blueHomePrimaryColorTrans", data["blueUniversity"]["color_home_primary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_home_primary"]}e6` : "#0051ffe6");
                $(':root').css("--blueHomeSecondaryColorTrans", data["blueUniversity"]["color_home_secondary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_home_secondary"]}e6` : "#0051ffe6");
                $(':root').css("--blueAwayPrimaryColorTrans", data["blueUniversity"]["color_away_primary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_away_primary"]}e6` : "#0051ffe6");
                $(':root').css("--blueAwaySecondaryColorTrans", data["blueUniversity"]["color_away_secondary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_away_secondary"]}e6` : "#0051ffe6");
                $(':root').css("--blueAlternatePrimaryColorTrans", data["blueUniversity"]["color_alternate_primary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_alternate_primary"]}e6` : "#0051ffe6");
                $(':root').css("--blueAlternateSecondaryColorTrans", data["blueUniversity"]["color_alternate_secondary"] !== "" && data["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["blueUniversity"]["color_alternate_secondary"]}e6` : "#0051ffe6");
                $(':root').css("--orangeHomePrimaryColorTrans", data["orangeUniversity"]["color_home_primary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_home_primary"]}e6` : "#ffaa00e6");
                $(':root').css("--orangeHomeSecondaryColorTrans", data["orangeUniversity"]["color_home_secondary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_home_secondary"]}e6` : "#ffaa00e6");
                $(':root').css("--orangeAwayPrimaryColorTrans", data["orangeUniversity"]["color_away_primary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_away_primary"]}e6` : "#ffaa00e6");
                $(':root').css("--orangeAwaySecondaryColorTrans", data["orangeUniversity"]["color_away_secondary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_away_secondary"]}e6` : "#ffaa00e6");
                $(':root').css("--orangeAlternatePrimaryColorTrans", data["orangeUniversity"]["color_alternate_primary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_alternate_primary"]}e6` : "#ffaa00e6");
                $(':root').css("--orangeAlternateSecondaryColorTrans", data["orangeUniversity"]["color_alternate_secondary"] !== "" && data["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `#${data["orangeUniversity"]["color_alternate_secondary"]}e6` : "#ffaa00e6");
              });
              
              function WhiteOrBlack(bgColor) {
                let r = parseInt(bgColor.substring(0, 2), 16);
                let g = parseInt(bgColor.substring(2, 4), 16);
                let b = parseInt(bgColor.substring(4, 6), 16);
                let uicolors = [r / 255.0, g / 255.0, b / 255.0];
                let c = uicolors.map((col) => {
                  if (col <= 0.03928) {
                    return col / 12.92;
                  }
                  return Math.pow((col + 0.055) / 1.055, 2.4);
                });
                let L = (0.2126 * c[0]) + (0.7152 * c[1]) + (0.0722 * c[2]);
                return (L > 0.179);
              }

              //<!--- SOS Overlay Control System --->
              WsSubscribers.init(49322, false);
              WsSubscribers.subscribe("game", "update_state", (d) => {
                players = d['players'];
                if (d['game']['hasTarget'] === true && !d['game']['isReplay']) {
                  let selectedPlayer = d['players'][d['game']['target']]
                  $("#player-name").text(selectedPlayer['name']);
                  $("#player-score").text(selectedPlayer['score']);
                  $("#player-goals").text(selectedPlayer['goals']);
                  $("#player-assists").text(selectedPlayer['assists']);
                  $("#player-shots").text(selectedPlayer['shots']);
                  $("#player-touches").text(selectedPlayer['touches']);
                  $("#player-saves").text(selectedPlayer['saves']);
                  $("#player-score").text(selectedPlayer['score']);
                  $("#player-speed").text(`${selectedPlayer['speed']} KPH`);
                  $("#player-boost").text(selectedPlayer['boost']);
                  $("#player-speed").css("color", selectedPlayer['boost'] >= 85 ? "black" : "white");
                  $(':root').css("--boost-level", `${selectedPlayer['boost']}%`);
                  if (selectedPlayer['team'] === 0) {
                      $("#player-summary").removeClass("hidden");
                      $("#player-summary").removeClass("orange");
                      $("#player-summary").removeClass("white");
                      $("#player-summary").removeClass("black");
                      $("#player-summary").removeClass("home");
                      $("#player-summary").removeClass("away");
                      $("#player-summary").removeClass("alternate");
                      $("#player-summary").addClass("blue");

                      if (overlayData["blueTeamAdvancedSettings"]["useHome"]) {
                        $("#player-summary").addClass("home");
                        $("#player-summary").addClass(WhiteOrBlack(overlayData["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `${overlayData["blueUniversity"]["color_home_primary"]}` : "0051ff") ? "black" : "white")
                      } else if (overlayData["blueTeamAdvancedSettings"]["useAway"]) {
                        $("#player-summary").addClass("away");
                        $("#player-summary").addClass(WhiteOrBlack(overlayData["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `${overlayData["blueUniversity"]["color_away_primary"]}` : "0051ff") ? "black" : "white")
                      } else if (overlayData["blueTeamAdvancedSettings"]["useAlternate"]) {
                        $("#player-summary").addClass("alternate");
                        $("#player-summary").addClass(WhiteOrBlack(overlayData["blueTeamAdvancedSettings"]["useDefaultColors"] === false ? `${overlayData["blueUniversity"]["color_alternate_primary"]}` : "0051ff") ? "black" : "white")
                      }
                  } else {
                    $("#player-summary").removeClass("hidden");
                      $("#player-summary").removeClass("blue");
                      $("#player-summary").removeClass("white");
                      $("#player-summary").removeClass("black");
                      $("#player-summary").removeClass("home");
                      $("#player-summary").removeClass("away");
                      $("#player-summary").removeClass("alternate");
                      $("#player-summary").addClass("orange");

                      if (overlayData["orangeTeamAdvancedSettings"]["useHome"]) {
                        $("#player-summary").addClass("home");
                        $("#player-summary").addClass(WhiteOrBlack(overlayData["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `${overlayData["orangeUniversity"]["color_home_primary"]}` : "0051ff") ? "black" : "white")
                      } else if (overlayData["orangeTeamAdvancedSettings"]["useAway"]) {
                        $("#player-summary").addClass("away");
                        $("#player-summary").addClass(WhiteOrBlack(overlayData["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `${overlayData["orangeUniversity"]["color_away_primary"]}` : "0051ff") ? "black" : "white")
                      } else if (overlayData["orangeTeamAdvancedSettings"]["useAlternate"]) {
                        $("#player-summary").addClass("alternate");
                        $("#player-summary").addClass(WhiteOrBlack(overlayData["orangeTeamAdvancedSettings"]["useDefaultColors"] === false ? `${overlayData["orangeUniversity"]["color_alternate_primary"]}` : "0051ff") ? "black" : "white")
                      }
                  }
                } else {
                  $("#player-summary").removeClass("blue");
                  $("#player-summary").removeClass("orange");
                  $("#player-summary").removeClass("white");
                  $("#player-summary").removeClass("black");
                  $("#player-summary").removeClass("home");
                  $("#player-summary").removeClass("away");
                  $("#player-summary").addClass("hidden");
                }
              })
            });
        </script>
    </body>
</html>